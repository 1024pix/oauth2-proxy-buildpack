# heroku-buildpack-oauth2-proxy

Installs [pusher/oauth2_proxy](https://github.com/pusher/oauth2_proxy)

```console
heroku buildpacks:add https://github.com/cfra/heroku-buildpack-oauth2-proxy
```

## Starting on heroku

You need to ensure both your backend and `oauth2_proxy` are started by your
`Procfile`. The easiest way is the provided script `start_with_oauth2_proxy.sh`.

Pass in the call to start your backend as its arguments. For example, the
[heroku-buildpack-static](https://github.com/heroku/heroku-buildpack-static)
has `/app/bin/boot` as entrypoint. Given that, a usable `Procfile` to run it
with the proxy could look as following:

```console
web: /app/bin/start_with_oauth2_proxy.sh /app/bin/boot
```

## Configuration

The following environment variables are required:

- `OAUTH2_PROXY_PROVIDER`: The provider to use. Something like `github`, `google` or `facebook`
- `OAUTH2_PROXY_CLIENT_ID`: The oauth2 client id (generated by auth provider)
- `OAUTH2_PROXY_CLIENT_SECRET`: The oauth2 client secret (generated by auth provider)
- `OAUTH2_PROXY_COOKIE_SECRET`: Secret key to encrypt `oauth2_proxy`'s session cookies

Optionally, you can provide the following:

- `OAUTH2_GITHUB_ORG`: Only allows login for members of the given github organization
- `OAUTH2_EMAIL_DOMAIN`: Only allows login for users with emails from this domain
