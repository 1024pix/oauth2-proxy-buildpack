#!/usr/bin/env bash

set -eo pipefail

BP_DIR="$(cd $(dirname "$0"); pwd)"
BUILD_DIR="$1"

mkdir -p "$BUILD_DIR/bin"

echo "downloading oauth2_proxy..."
wget https://github.com/pusher/oauth2_proxy/releases/download/v3.1.0/oauth2_proxy-v3.1.0.linux-amd64.go1.11.tar.gz
tar -xzf oauth2_proxy-*.tar.gz
rm oauth2_proxy-*.tar.gz
mv release/oauth2_proxy-linux-amd64 $BUILD_DIR/bin/oauth2_proxy
rmdir release

# write out a start script
cp "${BP_DIR}"/../scripts/start_*.sh "${BUILD_DIR}/bin"
